<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Lightning Out Example test!</title>
    <script>
        // Salesforce OAuth Credentials (Replace with your actual values)
        const CLIENT_ID = "3MVG9GBhY6wQjl2v2qOvZNO6DHA5O4UCEo8TEmLJrnuvETtSUR97T66RVVMnb0TZVvJbf79xRGHqYn0choZkA";
        const CLIENT_SECRET = "3BE23422C292909A4CD0884C0841F82C601FFBEE14FF6AAEFF93370E9D595F76";
        const SF_LOGIN_URL = "https://metacube52.my.salesforce.com";
        const SF_INSTANCE_URL = "https://metacube52.lightning.force.com/";
        const SF_USERNAME = "anuj.khandelwal-dbtc@force.com"; 
        const SF_PASSWORD = "Metacube123PoTT6YXEolw8urlhl93yfItw"; // Append Security Token if needed

        // Function to authenticate with Salesforce and get an access token
        // async function authenticateWithSalesforce() {
        //  loadLightningComponent('00DdN00000XBuv7!AQEAQM4qgkUHtwNev6Milzl54PT0iXuRyJFTA2.Sp7tbiU3zTlOGA5dtkqzWPxPVa2g7YYAIhl.5nFsFGqWYMqu28WGQsPv.');
                
        // }
        const redirectUri = 'https://localhost:8080/callback'; // Callback URL you set in Salesforce
        const authUrl = `https://login.salesforce.com/services/oauth2/authorize?response_type=code&client_id=${CLIENT_ID}&redirect_uri=${redirectUri}`;
        window.location.href = authUrl;

        // Step 3: Extract the code from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');  // Get the authorization code

        // Step 4: Exchange the code for an access token
        if (code) {
            fetch('https://metacube52.my.salesforce.com/services/oauth2/token', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({
                'grant_type': 'authorization_code',
                'code': code,
                'client_id': CLIENT_ID,  // Consumer Key
                'client_secret': CLIENT_SECRET,  // Consumer Secret
                'redirect_uri': 'https://localhost:8080/callback'  // Same URL used for redirect
            })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Access Token:yupppppp');
                console.log('Access Token:', data.access_token);
                loadLightningComponent(data.access_token);
                // You can now use the access token to make API calls
            })
            .catch(error => {
                console.error('Error exchanging code for access token', error);
            });
        }

        // Function to load Lightning Out component
        function loadLightningComponent(oauthToken) {
            const script = document.createElement("script");
            script.src = SF_INSTANCE_URL+'/lightning/lightning.out.js';
            script.onload = function () {
                $Lightning.use("c:LightningOutDependencyApp",
                    function () {
                        $Lightning.createComponent(
                            "c:homepageheader",
                            {message: "Hello from VF!"},
                            "lightning-container",
                            function (component) {
                                console.log("Lightning Component loaded!", component);
                            }
                        );
                    },
                    SF_INSTANCE_URL,
                    oauthToken // Pass the authenticated token
                );
            };
            document.head.appendChild(script);
        }

        // Start authentication on page load
        window.onload = function () {
            authenticateWithSalesforce();
        };
    </script>
</head>
<body>
    <h2>Salesforce Lightning Out Example</h2>
    <div id="lightning-container"></div>
</body>
</html>
